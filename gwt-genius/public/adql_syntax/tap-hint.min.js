!function(){function a(a,b){for(var c=0,d=a.length;d>c;++c)b(a[c])}function b(a,b){if(!Array.prototype.indexOf){for(var c=a.length;c--;)if(a[c].toUpperCase()===b.toUpperCase())return!0;return!1}var d=a.map(function(a){return a.toLowerCase()});return-1!=d.indexOf(b.toLowerCase())}function c(c,d,f,g,h,i){function j(a){0!=a.toLowerCase().indexOf(l.toLowerCase())||b(k,a)||k.push(a)}i="undefined"==typeof i?"":i;var k=[],l=c.string;if(d){var m=d.pop();return e(m.string,l,k,h,i),k.sort()}return a(f,j),k.sort()}function d(a,c,d,e){if(a.length>0)for(var f=0;f<a.length;f++)for(var g=jQuery.trim(a[f]),h=g.split("."),i=0;i<h.length;i++)0!=h[i].toLowerCase().indexOf(d.toLowerCase())||b(c,h[i])||h[i].toLowerCase()==e.toLowerCase()||c.push(h[i])}function e(a,b,c,e,f){f="undefined"==typeof f?"":f,e.autocompleteInfo&&jQuery("#"+e.autocompleteInfo).html("Loading catalogue metadata keywords for auto-complete"),e.autocompleteLoader&&jQuery("#"+e.autocompleteLoader).show(),jQuery.ajax({type:"POST",async:!1,data:{keyword:a,optional_keyword:f,mode:"tap",resource:e.tapResource},url:e.webServicePath,timeout:1e6,error:function(){e.autocompleteInfo&&jQuery("#"+e.autocompleteInfo).html("CTRL + Space to activate auto-complete"),e.autocompleteLoader&&jQuery("#"+e.autocompleteLoader).hide()},success:function(f){""!=f&&d(f,c,b,a),e.autocompleteInfo&&jQuery("#"+e.autocompleteInfo).html("CTRL + Space to activate auto-complete"),e.autocompleteLoader&&jQuery("#"+e.autocompleteLoader).hide()}})}function f(c,d,e,f){function g(a){0!=a.toLowerCase().indexOf(j.toLowerCase())||b(i,a)||i.push(a)}function h(b){"string"==typeof b?a(editor.availableTags,g):b instanceof Array?a(editor.availableTags,g):b instanceof Function&&a(editor.availableTags,g);for(var c in b)g(c)}var i=[],j=c.string;if(d){var k,l=d.pop();for(0===l.type.indexOf("variable")?(f&&f.additionalContext&&(k=f.additionalContext[l.string]),k=k||window[l.string]):"string"==l.type?k="":"atom"==l.type?k=1:"function"==l.type&&(null==window.jQuery||"$"!=l.string&&"jQuery"!=l.string||"function"!=typeof window.jQuery?null!=window._&&"_"==l.string&&"function"==typeof window._&&(k=window._()):k=window.jQuery());null!=k&&d.length;)k=k[d.pop().string];null!=k&&h(k)}else a(e,g);return i.sort()}function g(a,b,d,e){var g=a.getCursor(),h=d(a,g),i=h,j=null;for(/^[\w$_]*$/.test(h.string)||(h=i={start:g.ch,end:g.ch,string:"",state:h.state,type:"."==h.string?"property":null}),token_start_original=h.start,token_end_original=h.end,line_original=g.line,cur_temp={},cur_temp.line=g.line,cur_temp.ch=h.start,token_temp=d(a,cur_temp),"."==token_temp.string&&(j=h.string,h=i={start:cur_temp.ch,end:cur_temp.ch,string:"",state:token_temp,type:"."==token_temp.string?"property":null});"property"==i.type;){if(i=d(a,{line:g.line,ch:i.start}),"."!=i.string)return;if(i=d(a,{line:g.line,ch:i.start}),")"==i.string){var k=1;do switch(i=d(a,{line:g.line,ch:i.start}),i.string){case")":k++;break;case"(":k--}while(k>0);if(i=d(a,{line:g.line,ch:i.start}),0!==i.type.indexOf("variable"))return;i.type="function"}if(!l)var l=[];l.push(i)}return 1!=a.useAutocompleteService?{list:f(h,l,b,e),from:{line:line_original,ch:token_start_original},to:{line:line_original,ch:token_end_original}}:{list:c(h,l,b,e,a,j),from:{line:line_original,ch:token_start_original},to:{line:line_original,ch:token_end_original}}}CodeMirror.tapHint=function(a,b,c){function d(f){function g(b){a.replaceRange(b,k.from,k.to)}function h(){s||(s=!0,m.parentNode.removeChild(m))}function i(){g(l[n.selectedIndex]),h(),setTimeout(function(){a.focus()},50)}if(!a.somethingSelected()){var j=a.getTokenAt(a.getCursor());if(!e.closeOnTokenChange||null==f||j.start==f.start&&j.type==f.type){var k=b(a,c);if(k&&k.list.length){var l=k.list;if(e.completeSingle&&1==l.length)return g(l[0]),!0;var m=document.createElement("div");m.className="CodeMirror-completions";var n=m.appendChild(document.createElement("select"));window.opera||(n.multiple=!0);for(var o=0;o<l.length;++o){var p=n.appendChild(document.createElement("option"));p.appendChild(document.createTextNode(l[o]))}n.firstChild.selected=!0,n.size=Math.min(10,l.length);var q=a.cursorCoords(e.alignWithWord?k.from:null);m.style.left=q.left+"px",m.style.top=q.bottom+"px",document.body.appendChild(m);var r=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth);r-q.left<n.clientWidth&&(m.style.left=q.left-n.clientWidth+"px"),l.length<=10&&(m.style.width=n.clientWidth-1+"px");var s=!1;return CodeMirror.on(n,"blur",h),CodeMirror.on(n,"keydown",function(b){var c=b.keyCode;13==c?(CodeMirror.e_stop(b),i()):27==c?(CodeMirror.e_stop(b),h(),a.focus()):38==c||40==c||33==c||34==c||CodeMirror.isModifierKey(b)||(h(),a.focus(),a.triggerOnKeyDown(b),e.closeOnBackspace&&8==c||setTimeout(function(){d(j)},50))}),CodeMirror.on(n,"dblclick",i),n.focus(),window.opera&&setTimeout(function(){s||n.focus()},100),!0}}}}var e={},f=CodeMirror.tapHint.defaults;c.tapResource&&(a.tapResource=c.tapResource),c.webServicePath&&(a.webServicePath=c.webServicePath),c.autocompleteLoader&&(a.autocompleteLoader=c.autocompleteLoader),c.autocompleteInfo&&(a.autocompleteInfo=c.autocompleteInfo),c.useAutocompleteService&&(a.useAutocompleteService=c.useAutocompleteService),c.availableTags?a.availableTags=c.availableTags:a.availableTags||(a.availableTags=["SELECT","FROM","ORDER BY","WHERE","TOP","IN","AND","OR","WITH","DESC","ASC","JOIN","AS","HAVING","ABS","GROUP","BY","INNER","OUTER","CROSS","LEFT","RIGHT","FULL","ON","USING","MIN","MAX","COUNT","DISTINCT","ALL","LIKE","ACOS","ASIN","ATAN","ATAN2","COS","SIN","TAN","COT","IS","NOT","NULL","NATURAL","EXISTS","BETWEEN","AREA","BOX","CENTROID","CIRCLE","CONTAINS","COORD1","COORD2","COORDSYS","DISTANCE","INTERSECTS","POINT","POLYGON","REGION"]);for(var g in f)f.hasOwnProperty(g)&&(e[g]=(c&&c.hasOwnProperty(g)?c:f)[g]);return d()},CodeMirror.tapHint.defaults={closeOnBackspace:!0,closeOnTokenChange:!1,completeSingle:!0,alignWithWord:!0},CodeMirror.adqlHint=function(a,b){return g(a,a.availableTags,function(a,b){return a.getTokenAt(b)},b)}}();